var stateChampionships = [
  {
    state: "GA",
    week: 1,
    gschools: 167,
    gathletes: 427,
    bschools: 367,
    bathletes: 7943,
  },
  {
    state: "LA",
    week: 1,
    gschools: 12,
    gathletes: 16,
    bschools: 97,
    bathletes: 1772,
  },
  {
    state: "MT",
    week: 1,
    gschools: 22,
    gathletes: 40,
    bschools: 97,
    bathletes: 1380,
  },
  {
    state: "AL",
    week: 2,
    gschools: 0,
    gathletes: 0,
    bschools: 116,
    bathletes: 3080,
  },
  {
    state: "AZ",
    week: 2,
    gschools: 136,
    gathletes: 481,
    bschools: 202,
    bathletes: 4894,
  },
  {
    state: "AR",
    week: 2,
    gschools: 23,
    gathletes: 54,
    bschools: 52,
    bathletes: 1137,
  },
  {
    state: "CO",
    week: 2,
    gschools: 0,
    gathletes: 140,
    bschools: 235,
    bathletes: 5290,
  },
  {
    state: "IL",
    week: 2,
    gschools: 0,
    gathletes: 676,
    bschools: 423,
    bathletes: 14170,
  },
  {
    state: "IN",
    week: 2,
    gschools: 115,
    gathletes: 259,
    bschools: 314,
    bathletes: 6363,
  },
  {
    state: "IA",
    week: 2,
    gschools: 75,
    gathletes: 204,
    bschools: 279,
    bathletes: 6523,
  },
  {
    state: "ME",
    week: 2,
    gschools: 33,
    gathletes: 78,
    bschools: 66,
    bathletes: 719,
  },
  {
    state: "MO",
    week: 2,
    gschools: 168,
    gathletes: 956,
    bschools: 252,
    bathletes: 6450,
  },
  {
    state: "NE",
    week: 2,
    gschools: 0,
    gathletes: 168,
    bschools: 252,
    bathletes: 4463,
  },
  {
    state: "NV",
    week: 2,
    gschools: 18,
    gathletes: 124,
    bschools: 79,
    bathletes: 1976,
  },
  {
    state: "NH",
    week: 2,
    gschools: 0,
    gathletes: 38,
    bschools: 42,
    bathletes: 705,
  },
  {
    state: "NM",
    week: 2,
    gschools: 64,
    gathletes: 154,
    bschools: 64,
    bathletes: 1629,
  },
  {
    state: "NC",
    week: 2,
    gschools: 0,
    gathletes: 0,
    bschools: 337,
    bathletes: 7754,
  },
  {
    state: "ND",
    week: 2,
    gschools: 18,
    gathletes: 27,
    bschools: 94,
    bathletes: 889,
  },
  {
    state: "TX",
    week: 2,
    gschools: 337,
    gathletes: 4421,
    bschools: 365,
    bathletes: 10998,
  },
  {
    state: "UT",
    week: 2,
    gschools: 0,
    gathletes: 124,
    bschools: 117,
    bathletes: 3323,
  },
  {
    state: "VA",
    week: 2,
    gschools: 107,
    gathletes: 223,
    bschools: 270,
    bathletes: 6229,
  },
  {
    state: "WA",
    week: 2,
    gschools: 238,
    gathletes: 1864,
    bschools: 299,
    bathletes: 9251,
  },
  {
    state: "CA",
    week: 3,
    gschools: 759,
    gathletes: 6014,
    bschools: 904,
    bathletes: 22602,
  },
  {
    state: "CT",
    week: 3,
    gschools: 0,
    gathletes: 134,
    bschools: 124,
    bathletes: 2307,
  },
  {
    state: "DE",
    week: 3,
    gschools: 7,
    gathletes: 11,
    bschools: 44,
    bathletes: 872,
  },
  {
    state: "ID",
    week: 3,
    gschools: 49,
    gathletes: 112,
    bschools: 103,
    bathletes: 2519,
  },
  {
    state: "KS",
    week: 3,
    gschools: 0,
    gathletes: 276,
    bschools: 217,
    bathletes: 4724,
  },
  {
    state: "KY",
    week: 3,
    gschools: 0,
    gathletes: 123,
    bschools: 103,
    bathletes: 1902,
  },
  {
    state: "MA",
    week: 3,
    gschools: 0,
    gathletes: 126,
    bschools: 211,
    bathletes: 3970,
  },
  {
    state: "MS",
    week: 3,
    gschools: 0,
    gathletes: 0,
    bschools: 2,
    bathletes: 25,
  },
  {
    state: "NY",
    week: 3,
    gschools: 0,
    gathletes: 168,
    bschools: 449,
    bathletes: 11184,
  },
  {
    state: "OK",
    week: 3,
    gschools: 59,
    gathletes: 98,
    bschools: 150,
    bathletes: 3844,
  },
  {
    state: "OR",
    week: 3,
    gschools: 140,
    gathletes: 597,
    bschools: 150,
    bathletes: 3844,
  },
  {
    state: "RI",
    week: 3,
    gschools: 0,
    gathletes: 32,
    bschools: 34,
    bathletes: 825,
  },
  {
    state: "SC",
    week: 3,
    gschools: 0,
    gathletes: 0,
    bschools: 147,
    bathletes: 4530,
  },
  {
    state: "SD",
    week: 3,
    gschools: 12,
    gathletes: 36,
    bschools: 113,
    bathletes: 1583,
  },
  {
    state: "TN",
    week: 3,
    gschools: 93,
    gathletes: 414,
    bschools: 188,
    bathletes: 3891,
  },
  {
    state: "VT",
    week: 3,
    gschools: 5,
    gathletes: 9,
    bschools: 12,
    bathletes: 114,
  },
  {
    state: "WI",
    week: 3,
    gschools: 0,
    gathletes: 0,
    bschools: 336,
    bathletes: 6669,
  },
  {
    state: "WY",
    week: 3,
    gschools: 13,
    gathletes: 22,
    bschools: 53,
    bathletes: 1395,
  },
  {
    state: "FL",
    week: 4,
    gschools: 0,
    gathletes: 475,
    bschools: 365,
    bathletes: 7789,
  },
  {
    state: "HI",
    week: 4,
    gschools: 55,
    gathletes: 620,
    bschools: 58,
    bathletes: 1113,
  },
  {
    state: "MD",
    week: 4,
    gschools: 94,
    gathletes: 199,
    bschools: 177,
    bathletes: 4415,
  },
  {
    state: "MI",
    week: 4,
    gschools: 0,
    gathletes: 327,
    bschools: 466,
    bathletes: 9167,
  },
  {
    state: "MN",
    week: 4,
    gschools: 0,
    gathletes: 20,
    bschools: 343,
    bathletes: 8058,
  },
  {
    state: "NJ",
    week: 4,
    gschools: 0,
    gathletes: 477,
    bschools: 311,
    bathletes: 9648,
  },
  {
    state: "WV",
    week: 4,
    gschools: 0,
    gathletes: 0,
    bschools: 91,
    bathletes: 1663,
  },
  {
    state: "OH",
    week: 5,
    gschools: 0,
    gathletes: 0,
    bschools: 619,
    bathletes: 10313,
  },
  {
    state: "PA",
    week: 5,
    gschools: 0,
    gathletes: 0,
    bschools: 473,
    bathletes: 9460,
  },
  {
    state: "AK",
    week: 0,
    gschools: 69,
    gathletes: 347,
    bschools: 98,
    bathletes: 1249,
  },
  {
    state: "DC",
    week: 2,
    gschools: 2,
    gathletes: 7,
    bschools: 9,
    bathletes: 183,
  },
];

var statesToHighlight;
var bAthletesActive = 0;
var bSchoolsActive = 0;
var gSchoolsActive = 0;
var gAthletesActive = 0;
var totalBAthletes = 0;
var totalBSchools = 0;
var totalGAthletes = 0;
var totalGSchools = 0;

function activeStates(num) {
  var stateCompetingObj = new Object();
  bAthletesActive = 0;
  bSchoolsActive = 0;
  gSchoolsActive = 0;
  gAthletesActive = 0;
  totalBAthletes = 0;
  totalBSchools = 0;
  totalGAthletes = 0;
  totalGSchools = 0;
  //if(num != '' && num != undefined){
  for (i = 0; i < stateChampionships.length; i++) {
    totalBAthletes += stateChampionships[i].bathletes;
    totalBSchools += stateChampionships[i].bschools;
    totalGAthletes += stateChampionships[i].gathletes;
    totalGSchools += stateChampionships[i].gschools;

    if (stateChampionships[i].week >= num && num != "") {
      stateCompetingObj[stateChampionships[i].state] = {
        fillKey: "stillCompeting",
      };
      bAthletesActive += stateChampionships[i].bathletes;
      bSchoolsActive += stateChampionships[i].bschools;
      gAthletesActive += stateChampionships[i].gathletes;
      gSchoolsActive += stateChampionships[i].gschools;
    } else if (num == "") {
      stateCompetingObj[stateChampionships[i].state] = {
        fillKey: "defaultFill",
      };
    } else {
      stateCompetingObj[stateChampionships[i].state] = {
        fillKey: "outOfSeasonFill",
      };
    }
  }
  return stateCompetingObj;
}

var hsSeasonMap;

function loadHSMap() {
  hsSeasonMap = new Datamap({
    element: document.getElementById("countryMapofHSEnding"),
    scope: "usa", // Currently supports 'usa' and 'world', however with custom map data you can specify your own
    projection: "equirectangular", // Style of projection to be used. try "mercator"
    height: null, // If not null, datamaps will grab the height of 'element'
    width: null, // If not null, datamaps will grab the width of 'element',
    responsive: false, // If true, call `resize()` on the map object when it should adjust it's size
    done: function () {}, // Callback when the map is done drawing
    fills: {
      defaultFill: "#f2f4f7", // The keys in this object map to the "fillKey" of [data] or [bubbles]
      arena: "black", //'#f50f26',
      dual: "#2515d1",
      stillCompeting: "#fabfb9",
      outOfSeasonFill: "#e6f0e9",
    },
    data: statesToHighlight, //statesToHighlight,
    dataType: "json", // For use with dataUrl, currently 'json' or 'csv'. CSV should have an `id` column
    dataUrl: null, // If not null, datamaps will attempt to fetch this based on dataType ( default: json )
    geographyConfig: {
      dataUrl: null, // If not null, datamaps will fetch the map JSON (currently only supports topojson)
      hideAntarctica: true,
      hideHawaiiAndAlaska: false,
      borderWidth: 1,
      borderOpacity: 1,
      borderColor: "grey", //'#FDFDFD',
      /* popupTemplate: function (geography, data) { // This function should just return a string
               return '&lt;div class="hoverinfo"&gt;&lt;strong&gt;' + geography.properties.name + '&lt;/strong&gt;&lt;/div&gt;';
             },*/
      popupOnHover: false, // True to show the popup while hovering
      highlightOnHover: false,
      highlightFillColor: "#FC8D59",
      highlightBorderColor: "rgba(250, 15, 160, 0.2)",
      highlightBorderWidth: 2,
      highlightBorderOpacity: 1,
    },
    bubblesConfig: {
      borderWidth: 0.2,
      borderOpacity: 1,
      borderColor: "grey", //'#FFFFFF',
      popupOnHover: true, // True to show the popup while hovering
      radius: null,
      popupTemplate: function (geography, data) {
        // This function should just return a string
        return (
          '<div class="hoverinfo"><strong>' + data.name + "</strong></div>"
        );
      },
      fillOpacity: 0.5,
      animate: true,
      highlightOnHover: true,
      highlightFillColor: "#FC8D59",
      highlightBorderColor: "rgba(250, 15, 160, 0.2)",
      highlightBorderWidth: 2,
      highlightBorderOpacity: 1,
      highlightFillOpacity: 0.85,
      exitDelay: 100, // Milliseconds
      key: JSON.stringify,
    },
  });
}

function getWeekMapDisplay() {
  let seasonSelect = document.getElementById("seasonSelect");
  var selectedText = seasonSelect.options[seasonSelect.selectedIndex].innerHTML;
  var selectedValue = seasonSelect.value;
  console.log(document.getElementById("v2Check").checked);
  if (selectedValue != "" && document.getElementById("v2Check").checked) {
    selectedValue++;
  }
  statesToHighlight = activeStates(selectedValue);
  let activeWr = bAthletesActive + gAthletesActive;
  let inactiveWr =
    totalBAthletes + totalGAthletes - (gAthletesActive + bAthletesActive);

  let activeC = bSchoolsActive * 2 + gSchoolsActive;
  let inactiveC = totalBSchools * 2 + totalGSchools - activeC;

  document.getElementById("activeWrestlers").innerText =
    selectedValue == "" ? "" : activeWr.toLocaleString("en-US");
  document.getElementById("activeWrestlersPerc").innerText =
    selectedValue == ""
      ? ""
      : Math.round((activeWr / (totalBAthletes + totalGAthletes)) * 100) + "%";

  document.getElementById("inactiveWrestlers").innerText =
    selectedValue == "" ? "" : inactiveWr.toLocaleString("en-US");
  document.getElementById("inactiveWrestlersPerc").innerText =
    selectedValue == ""
      ? ""
      : Math.round((inactiveWr / (totalBAthletes + totalGAthletes)) * 100) +
        "%";

  document.getElementById("activeCoaches").innerText =
    selectedValue == "" ? "" : activeC.toLocaleString("en-US");
  document.getElementById("activeCoachesPerc").innerText =
    selectedValue == ""
      ? ""
      : Math.round((activeC / (inactiveC + activeC)) * 100) + "%";

  document.getElementById("inactiveCoaches").innerText =
    selectedValue == "" ? "" : inactiveC.toLocaleString("en-US");
  document.getElementById("inactiveCoachesPerc").innerText =
    selectedValue == ""
      ? ""
      : Math.round((inactiveC / (inactiveC + activeC)) * 100) + "%";
  hsSeasonMap.updateChoropleth(statesToHighlight);
}
